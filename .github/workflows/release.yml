name: Release Automatizado

# Aciona o workflow sempre que houver um push para a branch principal (main)
on:
  push:
    branches:
      - main
  # Permite a execu\u00e7\u00e3o manual (opcional)
  workflow_dispatch:

# Define as permiss\u00f5es necess\u00e1rias para que o workflow possa criar tags e releases
permissions:
  contents: write
  issues: write
  pull-requests: write

jobs:
  # Job principal para criar o release
  release:
    name: Criar Novo Release
    runs-on: ubuntu-latest
    
    steps:
    
      # 1. Checkout do C\u00f3digo
      - name: Checkout do c\u00f3digo
        uses: actions/checkout@v4
        with:
          # Fetch all history and tags to allow semantic-release to calculate the version
          fetch-depth: 0
      
      # 2. Configura\u00e7\u00e3o do Ambiente Python
      - name: Configurar Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11' # Use a vers\u00e3o do Python que voc\u00ea usa no projeto

      # 3. Cache de Depend\u00eancias
      - name: Configurar Cache
        uses: actions/cache@v4
        with:
          path: ~/.cache/pip
          key: ${{ runner.os }}-pip-${{ hashFiles('pyproject.toml') }}
          restore-keys: |
            ${{ runner.os }}-pip-

      # 4. Instalar Semantic Release e Depend\u00eancias do Projeto
      # Instalamos o semantic-release e quaisquer depend\u00eancias necess\u00e1rias para que ele funcione.
      - name: Instalar Depend\u00eancias
        run: |
          python -m pip install --upgrade pip
          pip install python-semantic-release
          # Se o seu projeto tiver outras depend\u00eancias necess\u00e1rias para o build, instale-as aqui (ex: pip install -e .)

      # 5. Criar o Release
      - name: Executar o Release
        env:
          # TOKEN de seguran\u00e7a fornecido automaticamente pelo GitHub
          # Necess\u00e1rio para criar o release.
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # O comando 'publish' encontra o pr\u00f3ximo versionamento, cria a tag, faz o commit, e cria o Release.
          # Como voc\u00ea j\u00e1 instalou o pacote no ambiente, \u00e9 mais limpo executar diretamente.
          semantic-release publish